<script src="https://www.paypalobjects.com/api/checkout.js"></script>
<script>
  $(document).ready(function () {
    $('#placeOrder').click(function () {
      console.log("place order clicked");
        $.ajax({
          url: "",
          contentType: 'application/json',
          type: "POST",
          data: JSON.stringify({
            checkout_action: 'add_address',
            firstName: $('#firstName').val(),
            lastName: $('#lastName').val(),
            email: $('#email').val(),
            phoneNumber: $('#phoneNumber').val(),
            postalCode: $('#postalCode').val(),
            country: $('#country').val(),
            streetAddress: $('#streetAddress').val(),
            apartment: $('#apartment').val(),
            city: $('#city').val(),
            province: $('#province').val(),
          }),
          success: function () {
            window.location.href = "<%= checkout_path %>"
          }
      });
    })

    $('#editShipping').click( function() {
      console.log("edit shipping clicked")
      $.ajax({
        url: "",
        contentType: 'text/html',
        type: "GET",
        data: {prev: true},
        success: function () {
          window.location.href = "<%= checkout_path %>"
        }
      });
    })


    $('#editPayment').click( function() {
      console.log("edit payment clicked")
      $.ajax({
        url: "",
        contentType: 'text/html',
        type: "GET",
        data: {prev: true},
      });
    });

    $('#confirm-button').click(function () {
      console.log("confirm button clicked")
      $.ajax({
        url: "/checkout",
        contentType: 'text/html',
        type: "GET",
        data: {
          "checkout_action": "confirm_payment"
        },
        success: function () {
          window.location.href = "<%= checkout_path %>"
        }
      });
    });
  })
</script>
<div class="container">
  <!-- HERO SECTION-->
  <section class="py-5 bg-light">
    <div class="container">
      <div class="row px-4 px-lg-5 py-lg-4 align-items-center">
        <div class="col-lg-6">
          <h1 class="h2 text-uppercase mb-0">Checkout</h1>
        </div>
        <div class="col-lg-6 text-lg-right">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb justify-content-lg-end mb-0 px-0">
              <li class="breadcrumb-item"><a href="<%= products_path %>">Home</a></li>
              <li class="breadcrumb-item"><a href="<%= cart_path(Cart.current_cart(current_user)) %>">Cart</a></li>
              <li class="breadcrumb-item active" aria-current="page">Checkout</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </section>
  <section class="py-5">
    <!-- BILLING ADDRESS-->
    <h2 class="h5 text-uppercase mb-4"><%= @state %></h2>
    <div class="row">
      <%= render partial: @state %>
      
      <!-- ORDER SUMMARY-->
      <div class="col-lg-4">
        <div class="card border-0 rounded-0 p-lg-4 bg-light">
          <div class="card-body">
            <h5 class="text-uppercase mb-4">Your order</h5>
            <ul class="list-unstyled mb-0">
              <% @line_items.each do |line_item| %>
                <li class="d-flex align-items-center justify-content-between"><strong class="small font-weight-bold"><%= line_item.inventory.product.sku%></strong>
                  <span class="text-muted small"><%= line_item.inventory.product.property.price  * line_item.quantity %></span>
                </li>
                <li class="border-bottom my-2"></li>
              <% end %>
              <li class="d-flex align-items-center justify-content-between"><strong class="text-uppercase small font-weight-bold">Estimated Total</strong><span><%= @current_cart.total %></span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
